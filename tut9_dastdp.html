<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CARLsim: Tutorial 9: DA modulated STDP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">6.1.0</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tut9_dastdp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 9: DA modulated STDP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tut9s1_network_setup">9.1 Network setup</a><ul><li class="level2"><a href="#tut9s1s1_config">9.1.1 CONFIG state</a></li>
<li class="level2"><a href="#tut9s1s2_setup">9.1.2 SETUP state</a></li>
<li class="level2"><a href="#tut9s1s2_run">9.1.3 RUN state</a></li>
</ul>
</li>
<li class="level1"><a href="#tut9s2_results">9.2 Results</a><ul><li class="level2"><a href="#tut9s2s1_terminal">9.2.1 Terminal output</a></li>
<li class="level2"><a href="#tut9s2s2_monitor">9.2.2 Offline Analysis</a></li>
</ul>
</li>
<li class="level1"><a href="#tut9s3_cli">9.3 CLI (optional)</a></li>
<li class="level1"><a href="#tut9s9_references">References</a></li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Lars Niedermeier </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="ch5_synaptic_plasticity.html">Chapter 5: Synaptic Plasticity</a> </dd>
<dd>
<a class="el" href="ch7_monitoring.html">Chapter 7: Monitoring</a> </dd>
<dd>
<a class="el" href="ch9_matlab_oat.html">Chapter 9: MATLAB Offline Analysis Toolbox (OAT)</a></dd></dl>
<p>This tutorial shows how to use <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> for dopamine-modulated STDP (DA-STDP). While DA-STDP itself was implemented in former versions already, <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> 6 now allows to monitor the DA levels and releases with the Offline Analysis Toolkit (OAT).</p>
<p>This tutorials covers:</p><ul>
<li>Define a network with domaminergic neurons</li>
<li>Configure DA modulated STDP</li>
<li>Monitor DA releases and level in the target neuron group</li>
</ul>
<p>At the end of the tutorial, you will have:</p><ul>
<li>Built a simple <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> program with DA-STDP and simulated re-enforcement learning</li>
<li>Applied the <a class="el" href="classGroupMonitor.html" title="Class GroupMonitor. ">GroupMonitor</a> to monitor DA levels and visualized the DA releases in Matlab</li>
</ul>
<p>This tutorial assumes you have covered the tutorials</p><ul>
<li><a class="el" href="tut1_basic_concepts.html">Tutorial 1: Basic Concepts</a></li>
<li><a class="el" href="tut2_random_spnet.html">Tutorial 2: 80-20 Random Spiking Network</a></li>
<li><a class="el" href="tut3_plasticity.html">Tutorial 3: Plasticity</a></li>
</ul>
<h1><a class="anchor" id="tut9s1_network_setup"></a>
9.1 Network setup</h1>
<p>The following code snippets gives an overview how to setup the network. For further details, please refer to the full source code of this tutorial in <code>%%CARLSIM_ROOT_DIR%%/doc/source/tutorial/9_dastdp</code>.</p>
<h2><a class="anchor" id="tut9s1s1_config"></a>
9.1.1 CONFIG state</h2>
<p>Configure the target neuron group <em>g1</em> with Izhikevich regular spiking neurons. Dopaminergic neurons in group <em>gda</em> project to the target group <em>g1</em> and induce DA releases. The network's input <em>gin</em> and thalamatic noise <em>g1noise</em> is simulated by a poisson spiking generator.</p>
<div class="fragment"><div class="line"><a class="code" href="classCARLsim.html">CARLsim</a>* sim = <span class="keyword">new</span> <a class="code" href="classCARLsim.html">CARLsim</a>(<span class="stringliteral">&quot;DASTDP&quot;</span>, mode ? <a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a> : <a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>, <a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54">LoggerMode</a>(log), 1, 42);</div><div class="line">g1 = sim-&gt;<a class="code" href="classCARLsim.html#a6e11c10b6b079715074d857452c42e11">createGroup</a>(<span class="stringliteral">&quot;post-ex&quot;</span>, 1, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#aa6e1dc5ae50722ae3d693f2c963d84cd">setNeuronParameters</a>(g1, 0.02f, 0.2f, -65.0f, 8.0f);</div><div class="line">gin = sim-&gt;<a class="code" href="classCARLsim.html#a0bf4d12b0b90740faf9a2f6a4add0351">createSpikeGeneratorGroup</a>(<span class="stringliteral">&quot;pre-ex&quot;</span>, 1, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div><div class="line">g1noise = sim-&gt;<a class="code" href="classCARLsim.html#a0bf4d12b0b90740faf9a2f6a4add0351">createSpikeGeneratorGroup</a>(<span class="stringliteral">&quot;post-ex-noise&quot;</span>, 1, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div><div class="line">gda = sim-&gt;<a class="code" href="classCARLsim.html#a0bf4d12b0b90740faf9a2f6a4add0351">createSpikeGeneratorGroup</a>(<span class="stringliteral">&quot;DA neurons&quot;</span>, 500, <a class="code" href="carlsim__definitions_8h.html#aa34dd70afe719159cbec710fc701373b">DOPAMINERGIC_NEURON</a>);</div></div><!-- fragment --><p>Connect the input group <em>gin</em> and target group <em>g1</em> with plastic synapses for STDP and limit the weights to 20. Use fixed synapses for input connections and dopaminergic projections. Parameterize dopamine-modulated STDP for CUBA mode with the parameters set by default. Configure the network in to run in CUBA mode.</p>
<div class="fragment"><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a30b16b93d57551dcde0559e8a4e98e27">connect</a>(gin, g1, <span class="stringliteral">&quot;one-to-one&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(0.0, 1.0f, 20.0f), 1.0f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1), <a class="code" href="structRadiusRF.html">RadiusRF</a>(-1), <a class="code" href="carlsim__definitions_8h.html#a9baa3423c83e97f02e68daccf466ed4d">SYN_PLASTIC</a>);</div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a30b16b93d57551dcde0559e8a4e98e27">connect</a>(g1noise, g1, <span class="stringliteral">&quot;one-to-one&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(40.0f), 1.0f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1), <a class="code" href="structRadiusRF.html">RadiusRF</a>(-1), <a class="code" href="carlsim__definitions_8h.html#a40e0573abfe33884cbdaae75b5971955">SYN_FIXED</a>);</div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a30b16b93d57551dcde0559e8a4e98e27">connect</a>(gda, g1, <span class="stringliteral">&quot;full&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(0.0), 1.0f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1), <a class="code" href="structRadiusRF.html">RadiusRF</a>(-1), <a class="code" href="carlsim__definitions_8h.html#a40e0573abfe33884cbdaae75b5971955">SYN_FIXED</a>);  </div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#af69130fee82ddc631a62ed0878c65e9f">setSTDP</a>(gin, g1, <span class="keyword">true</span>, stdp, alphaPlus, tauPlus, alphaMinus, tauMinus);</div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a580acd7bfec3145c00014b0bd1742e2e">setConductances</a>(<span class="keyword">false</span>);</div></div><!-- fragment --><p>Configure the decay over time of DA in the target group with <em>tauDP</em> = 2000.0f.</p>
<div class="fragment"><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a88198ca833c0d254d5e7d75d2c8ee4fb">setNeuromodulator</a>(g1, 2000.0f);</div></div><!-- fragment --><p>Set an interactive spike generator on the dopminergic neurons to release DA.</p>
<div class="fragment"><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#adc71069e71cd551526ddafb3d873d649">setSpikeGenerator</a>(gda, iSpikeGen);</div></div><!-- fragment --><h2><a class="anchor" id="tut9s1s2_setup"></a>
9.1.2 SETUP state</h2>
<p>Setup the <a class="el" href="classConnectionMonitor.html" title="Class ConnectionMonitor. ">ConnectionMonitor</a> <em>CM</em> to monitor the weight changes by STDP of the plastic synapses. The <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> <em>gda</em> logs the firings of the dopaminergic neurons; <em>spikeMonPre</em> and <em>spikeMonPost</em> are used to determine the spike timing of synapses. The <a class="el" href="classGroupMonitor.html" title="Class GroupMonitor. ">GroupMonitor</a> <em>groupMonPost</em> keeps track of the DA level in the target group <em>g1</em>.</p>
<div class="fragment"><div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a>* CM = sim-&gt;<a class="code" href="classCARLsim.html#a0f4f273689484d0ceaa5a40f64fc82fc">setConnectionMonitor</a>(gin, g1, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div><div class="line">spikeMonPost = sim-&gt;<a class="code" href="classCARLsim.html#a1e0b4d170b65f5075f1a996554c842ab">setSpikeMonitor</a>(g1, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div><div class="line">spikeMonPre = sim-&gt;<a class="code" href="classCARLsim.html#a1e0b4d170b65f5075f1a996554c842ab">setSpikeMonitor</a>(gin, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a1e0b4d170b65f5075f1a996554c842ab">setSpikeMonitor</a>(gda, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div><div class="line">groupMonPost = sim-&gt;<a class="code" href="classCARLsim.html#a8ea5d069c849b257d8de63aa482f8837">setGroupMonitor</a>(g1, <span class="stringliteral">&quot;DEFAULT&quot;</span>);</div></div><!-- fragment --><p>To simulate the network input, create a <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> of 4 Hz and set it as spike rate on <em>gin</em> and <em>g1noise</em>.</p>
<div class="fragment"><div class="line"><a class="code" href="classPoissonRate.html">PoissonRate</a> in(1);</div><div class="line">in.<a class="code" href="classPoissonRate.html#a39ade841ecc17249712f693ef8ffaa19">setRates</a>(4.0f); <span class="comment">// 4Hz</span></div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a04f52d2840105c8ccacf8d378d1695cf">setSpikeRate</a>(gin, &amp;in);</div><div class="line">sim-&gt;<a class="code" href="classCARLsim.html#a04f52d2840105c8ccacf8d378d1695cf">setSpikeRate</a>(g1noise, &amp;in);</div></div><!-- fragment --><h2><a class="anchor" id="tut9s1s2_run"></a>
9.1.3 RUN state</h2>
<p>Run the simulation in 1000 ms steps for an arbitrary duration. The default is 60 seconds and can be changed utilizing the command line interface (see <a class="el" href="tut9_dastdp.html#tut9s3_cli">9.3 CLI (optional)</a>).</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> t = 0; t &lt; duration; t++) {</div><div class="line">    spikeMonPost-&gt;startRecording();</div><div class="line">    spikeMonPre-&gt;startRecording();</div><div class="line">    groupMonPost-&gt;startRecording();</div><div class="line">    sim-&gt;<a class="code" href="classCARLsim.html#aafb2d44405c96aafe089f96ff867018d">runNetwork</a>(1, 0, <span class="keyword">false</span>);</div><div class="line">    spikeMonPost-&gt;stopRecording();</div><div class="line">    spikeMonPre-&gt;stopRecording();</div><div class="line">    groupMonPost-&gt;stopRecording();</div><div class="line">    ...</div></div><!-- fragment --><p>For each iteration, the spike timing between pre-synaptic neuron and post-synaptic neuron is to be checked. If the post synaptic neuron has fired after the pre-synaptic neuron, the time difference is positiv and indicates a long term potentation (LTP). Then release DA by calling <a class="el" href="classInteractiveSpikeGenerator.html#ae27061f2e3e917f4aee691844dff1546">InteractiveSpikeGenerator::setQuotaAll</a> of <em>iSpikeGen</em>.</p>
<div class="fragment"><div class="line"><span class="comment">//for</span></div><div class="line">    ...</div><div class="line">    <span class="comment">// get spike time of pre-synaptic neuron post-synaptic neuron</span></div><div class="line">    spikesPre = spikeMonPre-&gt;getSpikeVector2D()[0]; <span class="comment">// pre-neuron spikes</span></div><div class="line">    spikesPost = spikeMonPost-&gt;getSpikeVector2D()[0]; <span class="comment">// post-neuron in spikes</span></div><div class="line">    </div><div class="line">    <span class="comment">// if LTP is detected, set up reward (activate DA neurons ) to reinforcement this synapse</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; spikesPre.size(); j++) { <span class="comment">// j: index of the (j+1)-th spike</span></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; spikesPost.size(); k++) { <span class="comment">// k: index of the (k+1)-th spike</span></div><div class="line">            <span class="keywordtype">int</span> diff = spikesPost[k] - spikesPre[j]; <span class="comment">// (post-spike time) - (pre-spike time)</span></div><div class="line">            <span class="keywordflow">if</span> (diff &gt; 0 &amp;&amp; diff &lt;= 20) {</div><div class="line">                <span class="keywordflow">if</span> (damod) {</div><div class="line">                    iSpikeGen-&gt;setQuotaAll(1);</div><div class="line">                    releases++;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    </div><div class="line">    std::vector&lt; std::vector&lt;float&gt; &gt; weights = CM-&gt;<a class="code" href="classConnectionMonitor.html#ab64d9ff17fece61e850660bdd4ca00d2">takeSnapshot</a>();</div><div class="line">    weight = weights[0][0];</div></div><!-- fragment --><p>Finalize the simulation by deleting the <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a> instance and print a short summary.</p>
<div class="fragment"><div class="line">    ...</div><div class="line">}</div><div class="line"><span class="keyword">delete</span> sim;</div><div class="line">printf(<span class="stringliteral">&quot;time: %ds on %s synapse: %s da-stdp: %s da-releases: %d weight: %f\n&quot;</span>, </div><div class="line">        duration, mode?<span class="stringliteral">&quot;GPU&quot;</span>:<span class="stringliteral">&quot;CPU&quot;</span>, coba?<span class="stringliteral">&quot;COBA&quot;</span>:<span class="stringliteral">&quot;CUBA&quot;</span>, damod?<span class="stringliteral">&quot;y&quot;</span>:<span class="stringliteral">&quot;n&quot;</span>, releases, weight);       </div></div><!-- fragment --><h1><a class="anchor" id="tut9s2_results"></a>
9.2 Results</h1>
<p>Build and install the tutorial by activating the cMake option CARLSIM_TUTORIALS.</p>
<p>To run the program on Windows, open a command prompt, change the working directory, and start the executeable with the default parameters. Adapt the procedure to other platforms like Linux as usual.</p>
<div class="fragment"><div class="line">cd &lt;CMAKE_INSTALL_PREFIX&gt;\tutorials\9_dastdp</div><div class="line">dastdp.exe</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="tut9_dastdp.html#tut9s3_cli">9.3 CLI (optional)</a></dd></dl>
<h2><a class="anchor" id="tut9s2s1_terminal"></a>
9.2.1 Terminal output</h2>
<p>By default, the logging is set to LoggerMode USER. The standard output begins with the configuration parameters of the network, like CUBA mode, weight change, and STDP parameters. Then the monitors are listed in the initialization section. After the standard summary of <a class="el" href="classCARLsim.html" title="CARLsim User Interface This class provides a user interface to the public sections of CARLsimCore sou...">CARLsim</a>, a custom printf shows the amount of DA releaeses and the synaptic weight at the end of the simulation.</p>
<div class="fragment"><div class="line">.*********************************************************************************</div><div class="line">.********************      Welcome to <a class="code" href="classCARLsim.html">CARLsim</a> 6.0      ***************************</div><div class="line">.*********************************************************************************</div><div class="line"></div><div class="line">.***************************** Configuring Network ********************************</div><div class="line">Starting <a class="code" href="classCARLsim.html">CARLsim</a> simulation <span class="stringliteral">&quot;DASTDP&quot;</span> in <a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a> mode</div><div class="line">Random number seed: 42</div><div class="line">E-<a class="code" href="snn__definitions_8h.html#ac8029e759e488586a53fda138fdda98f">STDP</a> enabled <span class="keywordflow">for</span> pre-ex(1) to post-ex(0)</div><div class="line">Running <a class="code" href="carlsim__datastructures_8h.html#af658a97db232c96b62751e7401fd325ea4a36ad09b7754b8a763b64ef0126facf">CUBA</a> mode (all synaptic conductances disabled)</div><div class="line">Update weight and weight change every 100 ms</div><div class="line">Weight Change Decay is enabled</div><div class="line"><a class="code" href="snn__definitions_8h.html#ac8029e759e488586a53fda138fdda98f">STDP</a> scale factor = 0.050, wtChangeDecay = 0.950</div><div class="line"></div><div class="line">.*****************      Initializing GPU 0 Runtime      *************************</div><div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a> 0 set for Connection 0: 1(pre-ex) =&gt; 0(post-ex)</div><div class="line"><a class="code" href="classSpikeMonitor.html">SpikeMonitor</a> set for group 0 (post-ex)</div><div class="line"><a class="code" href="classSpikeMonitor.html">SpikeMonitor</a> set for group 1 (pre-ex)</div><div class="line"><a class="code" href="classSpikeMonitor.html">SpikeMonitor</a> set for group 3 (DA neurons)</div><div class="line"><a class="code" href="classGroupMonitor.html">GroupMonitor</a> set for group 0 (post-ex)</div><div class="line"></div><div class="line">.********************    Simulation Summary      ***************************</div><div class="line">Network Parameters:     numNeurons = 503 (numNExcReg:numNInhReg = 0.2:0.0)</div><div class="line">                        numSynapses = 502</div><div class="line">                        maxDelay = 1</div><div class="line">Simulation Mode:        <a class="code" href="carlsim__datastructures_8h.html#af658a97db232c96b62751e7401fd325ea4a36ad09b7754b8a763b64ef0126facf">CUBA</a></div><div class="line">Random Seed:            42</div><div class="line">Timing:                 Model Simulation Time = 60 sec</div><div class="line">                        Actual Execution Time = 4.30 sec</div><div class="line">                        Speed Factor (Model/Real) = 14 x</div><div class="line">Average Firing Rate:    2+ms delay = 0.000 Hz</div><div class="line">                        1ms delay = 0.222 Hz</div><div class="line">                        Overall = 0.222 Hz</div><div class="line">Overall Spike Count Transferred:</div><div class="line">                        2+ms delay = 0</div><div class="line">                        1ms delay = 0</div><div class="line">Overall Spike Count:    2+ms delay = 0</div><div class="line">                        1ms delay = 6692</div><div class="line">                        Total = 6692</div><div class="line">.*********************************************************************************</div><div class="line"></div><div class="line">time: 60s on GPU synapse: <a class="code" href="carlsim__datastructures_8h.html#af658a97db232c96b62751e7401fd325ea4a36ad09b7754b8a763b64ef0126facf">CUBA</a> da-stdp: y da-releases: 17 weight: 5.874695</div></div><!-- fragment --><h2><a class="anchor" id="tut9s2s2_monitor"></a>
9.2.2 Offline Analysis</h2>
<p>Utilize the OAT to analyze the monitored synaptic weights and DA with Matlab. On Windows, open the subdirectory <code>scripts</code> in the FileExplorer and double click on the Matlab script <code>dastdpOAT.m</code>. Adapt the procedure to other platforms like Linux accordingly.</p>
<p>Validate that Matlab has the containing folder of the script as working directory. Select the script and execute the code with F9. The first line <code>initOAT.m</code> initializes the OAT installed relative to that working directory.</p>
<div class="fragment"><div class="line">% Synaptic weights</div><div class="line">CR = ConnectionReader(<span class="stringliteral">&#39;../results/conn_pre-ex_post-ex.dat&#39;</span>);</div><div class="line">[allTimestamps, allWeights] = CR.readWeights();</div><div class="line">SR = SpikeReader(<span class="stringliteral">&#39;../results/spk_DA neurons.dat&#39;</span>);</div><div class="line">spkData = SR.readSpikes(); % binWindowMs</div><div class="line">spkV = spkData(:,1);</div><div class="line">idx = (spkV&gt;0);</div><div class="line">subplot (4, 1, 1:3)</div><div class="line">plot(allTimestamps, allWeights, allTimestamps(idx), allWeights(idx), &#39;+&#39;);</div><div class="line">title(&#39;Synaptic weights with DA releases&#39;);</div><div class="line">ylabel(&#39;Synaptic Weight Strength&#39;);</div><div class="line"></div><div class="line">% DA level</div><div class="line">GR = GroupReader(&#39;../results/grp_post-ex.dat&#39;);</div><div class="line">[timestamps,data] = GR.readData();</div><div class="line">subplot (4, 1, 4)</div><div class="line">plot(timestamps, data, &#39;color&#39;, &#39;r&#39;);  </div><div class="line">title(&#39;DA level in target group&#39;);</div><div class="line">ylabel(&#39;DA level&#39;);</div><div class="line">xlabel(&#39;Time (ms)&#39;);</div></div><!-- fragment --><p>The ConnectionReader <em>CR</em> reads the weights stored by <a class="el" href="classConnectionMonitor.html#ab64d9ff17fece61e850660bdd4ca00d2" title="Takes a snapshot of the current weight state. ">ConnectionMonitor::takeSnapshot</a> and plots the weight changes over time. The SpikeReader <em>SR</em> reads the firing of the dopaminergic neurons and mark the times of the DA releases with red crosses (<code>+</code>).</p>
<p>The GroupReader <em>GR</em> reads the DA levels that were recorded by the <a class="el" href="classGroupMonitor.html" title="Class GroupMonitor. ">GroupMonitor</a> over time and plots them as red line in a subplot below the weight changes.</p>
<div class="image">
<img src="dastdpOAT.png" alt="dastdpOAT.png"/>
<div class="caption">
Fig. 1. Synaptic weights (blue) with DA releases and levels (red)</div></div>
<h1><a class="anchor" id="tut9s3_cli"></a>
9.3 CLI (optional)</h1>
<p>To enable the user to evaluate distinct configurations without compiling the code, the program provides a simple Command Line Interface (CLI).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div><div class="line"></div><div class="line">    <span class="comment">// simple command line interface with defaults  </span></div><div class="line">    <span class="keywordtype">unsigned</span> duration = 60; <span class="keyword">auto</span> arg1 = <span class="stringliteral">&quot;1. simulation time in s (default = 60s)&quot;</span>;</div><div class="line">    <span class="keywordtype">unsigned</span> coba = 0;      <span class="keyword">auto</span> arg2 = <span class="stringliteral">&quot;2. synapse: 1=COBA, 0=CUBA (default)&quot;</span>;</div><div class="line">    <span class="keywordtype">unsigned</span> damod = 1;     <span class="keyword">auto</span> arg3 = <span class="stringliteral">&quot;3. modulation: 1=DA is released by activating gDA (default), 0= no DA release&quot;</span>;</div><div class="line">    <span class="keywordtype">unsigned</span> type = 1;      <span class="keyword">auto</span> arg4 = <span class="stringliteral">&quot;4. stdp type: 1=DA_MOD (default), 0=STANDARD&quot;</span>;</div><div class="line">    <span class="keywordtype">unsigned</span> mode = 1;      <span class="keyword">auto</span> arg5 = <span class="stringliteral">&quot;5. backend 1=GPU (default), 0=CPU&quot;</span>;</div><div class="line">    <span class="keywordtype">unsigned</span> log = 0;       <span class="keyword">auto</span> arg6 = <span class="stringliteral">&quot;6. log 2=SILENT, 1=DEV, 0=USER (default)&quot;</span>;</div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> ((argc == 2 &amp;&amp; strncmp(<span class="stringliteral">&quot;-h&quot;</span>, argv[1], 2) == 0) || argc &gt; 7 || mode &gt; 1 || coba &gt; 1 || damod &gt; 1 || type &gt; 1 || log &gt; 2) {</div><div class="line">        printf(<span class="stringliteral">&quot;usage: [duration [synapse [modulation [stdp [backend [log]]]]]]\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;Arguments:\n\t%s\n\t%s\n\t%s\n\t%s\n\t%s\n\t%s\n&quot;</span>, arg1, arg2, arg3, arg4, arg5, arg6);</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div></div><!-- fragment --><h1><a class="anchor" id="tut9s9_references"></a>
References</h1>
<p><a href="http://izhikevich.org/publications/dastdp.htm" target="_blank">Solving the Distal Reward Problem through Linkage of STDP and Dopamine Signaling</a> (Izhikevich, 2007) </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jul 10 2023 12:42:35 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
